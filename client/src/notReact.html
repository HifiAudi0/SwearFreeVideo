<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<body>

    <form id="submit">
        <label for="url">Youtube URL (example: https://www.youtube.com/watch?v=IhQmXaEhksI) :</label><br />
        <input class="url" type="text" id="url" name="url" /><br />
        <input type="submit" value="Submit"></input>
    </form>

    <p id="data">Swearing Data: }</p><br />


    <p id="fetch">JS catch:</p>

    <div id="player"></div>

    <script>

        function printGlobalVars() {
            console.log("VIDEO ID", video_id);
            console.log("URL", url);
            console.log("SWEARING DATA", swearingData);
        }

        var form = document.getElementById("submit");
        function handleForm(event) { event.preventDefault(); sendUrl(); }
        form.addEventListener('submit', handleForm);

        var video_id, url, swearingData;
        function sendUrl() {
            // const url = document.getElementById("url").value;
            event.preventDefault();
            url = "https://www.youtube.com/watch?v=IhQmXaEhksI";
            console.log("URL", url);
            axios.post('http://127.0.0.1:3005/sendUrl/?url=https://www.youtube.com/watch?v=IhQmXaEhksI')
                .then(function (response, error) {
                    console.log("GOT RESPONSE", response);
                    JSON.stringify(response.data)
                    video_id = /v=(.*)/.exec(url)[1];
                    console.log("video_id", video_id);
                    // everythingGetsReturned(video_id, url, response.data);
                    console.log("DONEEEEEEEEEEEEEE")
                    // return [video_id, url, response.data];
                    swearingData = response.data;
                    printGlobalVars;
                    return;

                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        function everythingGetsReturned(video_id, url, data) {
            return video_id, url, data;
        }

        console.log("VIDEO ID OUTSIDE FUNCTION", video_id);
        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        function onYouTubeIframeAPIReady() {
            // var video_id = ""
            // var url = ""
            // var response_data = {};
            // video_id, url, response_data = sendUrl();
            // console.log("VIDEO ID......URL........", video_id, url);
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: 'M7lc1UVf-VE',
                playerVars: {
                    'playsinline': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // 4. The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            console.log("PLAYER", player)
            player.loadVideoById("bHQqvYy5KYo", 5, "large")

            // event.target.playVideo();
        }

        // 5. The API calls this function when the player's state changes.
        //    The function indicates that when playing a video (state=1),
        //    the player should play for six seconds and then stop.
        var done = false;
        function onPlayerStateChange(event) {

            if (event.data == window.YT.PlayerState.PLAYING && !done) {



                var currentTimestamp = 0;
                var startSwearing = 67.32;
                var durationSwearing = 12.24;
                var endSwearing = startSwearing + durationSwearing;


                setInterval(function () {
                    console.log("VIDEO ID", video_id);
                    console.log("URL", url);
                    console.log("SWEARING DATA", swearingData);

                    currentTimestamp = player.getCurrentTime()
                    console.log("CURRENT TIMESTAMP::: " + currentTimestamp);
                    console.log("START SWEARING::::", startSwearing, "ENDING SWEARING:::", endSwearing);
                    if (currentTimestamp > startSwearing && currentTimestamp < endSwearing) { // HARD CODED
                        console.log("SWEARING INCOMING")
                    } else { console.log("NO SWEARING::::") }
                }, 1000);
                done = true;
            }
        }
        function stopVideo() {
            player.stopVideo();
        }



    </script>


</body>

</html>